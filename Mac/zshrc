# ========== 開発一般 ==========

# ctrl+wを/まで削除の挙動に
WORDCHARS=${WORDCHARS//\//}

# ls
alias ls='ls -GF'
alias ll='ls -lGF'
alias sl="ls"
alias s="ls"
alias l="ls"

# プロジェクトルートにcdする
alias cdr='cd $(git rev-parse --show-toplevel 2>/dev/null) || pwd'

# grep
alias grep='grep --color=auto'

# Git
alias log="git log --decorate --format=format:'%C(bold cyan)%as%C(reset) %C(bold blue)%h%C(reset) %C(white bold)%<(14,trunc)%an%C(reset) %C(green)%<(38,trunc)%s%C(reset) '"
alias gs="git status"
alias ga="git add"
alias gc="git commit"
alias gp="git push"
alias gl=log
alias gd="git diff"
alias gf='git pull origin $(git branch --show-current)'
alias gff='git pull'
alias gz='git stash -u'
alias gzp='git stash pop'

# grmb: git remove branch
git_rmb() {
 local current_branch=$(git branch --show-current)
 local branches=$(git branch | grep -v "^\*" | sed 's/^[ \t]*//')
 local selected_branch=$(echo "$branches" | fzf \
   --prompt="Select branch to remove: " \
   --preview="git log --oneline --graph --color=always {}" \
   --header="Current branch: $current_branch")

 if [ -n "$selected_branch" ]; then
   git branch -d "$selected_branch"
   echo "Removed branch: $selected_branch"
 fi
}
alias grmb='git_rmb'

# gb: git checkout branch with fzf
git_checkout_fzf() {
  # remote 含め全ブランチ一覧を取得
  local branches=$(git branch -a --color=never | sed 's/^..//' | sort | uniq)
  local selected_branch=$(echo "$branches" | fzf \
    --prompt="Select branch to checkout: " \
    --preview="git log --oneline --graph --color=always {} | head -30" \
    --header="Current branch: $(git branch --show-current)" \
    --height=80%)

  if [ -n "$selected_branch" ]; then
    # remote ブランチの場合の対応（例: remotes/origin/foo → foo）
    local branch_name=$(echo "$selected_branch" | sed 's#remotes/[^/]*/##')
    git checkout "$branch_name"
  fi
}
alias gb='git_checkout_fzf'

# 補完の設定
autoload -Uz compinit
typeset -gA _compdump
_compdump[path]="${ZDOTDIR:-$HOME}/.zcompdump-${HOST}"

if [[ -r "${_compdump[path]}.zwc" && "${_compdump[path]}.zwc" -nt "${_compdump[path]}" ]]; then
  compinit -C -d "${_compdump[path]}"
else
  compinit -i -d "${_compdump[path]}"
  command zcompile -R -- "${_compdump[path]}.zwc" "${_compdump[path]}" 2>/dev/null
fi

# emacsclient
e() {
 if emacsclient --eval "t" > /dev/null 2>&1; then
   emacsclient -n "$@"
 else
   emacs "$@" &
 fi
}

# ========== 開発ソフトウェア・ツール ==========

# homebrewのbin優先
export PATH="/opt/homebrew/bin/:$PATH"

# docker
alias dcu='docker compose up'
alias dcd='docker compose down'
alias dcdv='docker compose down -v --remove-orphans'

# direnv
eval "$(direnv hook zsh)"

# Terraform
alias tf='terraform'

# Claude Code
export PATH="$HOME/.claude/local:$PATH"

# codex-acp
export PATH="$HOME/Install/codex-acp/target/release:$PATH"

# MySQL
export PATH="/opt/homebrew/opt/mysql@8.4/bin:$PATH"

# Ruby
eval "$(rbenv init - zsh)"

# Android Studio
# adbなど
export PATH="$HOME/Library/Android/sdk/platform-tools:$PATH"

# ========== 会社 ==========

# teachme_web_duvelのteachme_webコンテナ起動がうまく行かないときのためのDBリセット
alias tmresetdb='docker compose exec teachme_web bundle exec rails db:reset_with_initial_data'
alias tmup='gf && docker compose down && docker compose up'

# teachme_eboshigara
alias mup='gf && docker compose down && docker compose up'
